# ------------------------------------------------------------------------------
# GPU configuration.

# --- Tesla Workstation Products ----
# Tegra X1                      53
# Tesla K80                     37
# Tesla K40                     35
# Tesla K20                     35
# Tesla C2075                   20
# Tesla C2050/C2070             20
# --- NVIDIA Data Center Products ---
# NVIDIA A100                   80
# NVIDIA A40                    86
# NVIDIA A30                    80
# NVIDIA A10                    86
# NVIDIA A16                    86
# NVIDIA T4                     75
# NVIDIA V100                   70
# Tesla P100                    60
# Tesla P40                     61
# Tesla P4                      61
# Tesla M60                     52
# Tesla M40                     52
# Tesla K80                     37
# Tesla K40                     35
# Tesla K20                     35
# Tesla K10                     30
# ----- Quadro Desktop Products -----
# Quadro RTX A6000              86
# Quadro RTX A4000              86
# Quadro RTX A5000              86
# Quadro RTX 8000               75
# Quadro RTX 6000               75
# Quadro RTX 5000               75
# Quadro RTX 4000               75
# Quadro GV100                  70
# Quadro GP100                  60
# Quadro P6000                  61
# Quadro P5000                  61
# Quadro P4000                  61
# Quadro P2200                  61
# Quadro P2000                  61
# Quadro P1000                  61
# Quadro P620                   61
# Quadro P600                   61
# Quadro P400                   61
# Quadro M6000 24GB             52
# Quadro M6000                  52
# Quadro K6000                  35
# Quadro M5000                  52
# Quadro K5200                  35
# Quadro K5000                  30
# Quadro M4000                  52
# Quadro K4200                  30
# Quadro K4000                  30
# Quadro M2000                  52
# Quadro K2200                  50
# Quadro K2000                  30
# Quadro K2000D                 30
# Quadro K1200                  50
# Quadro K620                   50
# Quadro K600                   30
# Quadro K420                   30
# Quadro 410                    30
# Quadro Plex 7000              20
# ----- Quadro Mobile Products ------
# RTX 3060                      86
# RTX 3060Ti                    86
# RTX 5000                      75
# RTX 4000                      75
# RTX 3000                      75
# T2000                         75
# T1000                         75
# P620                          61
# P520                          61
# Quadro P5200                  61
# Quadro P4200                  61
# Quadro P3200                  61
# Quadro P5000                  61
# Quadro P4000                  61
# Quadro P3000                  61
# Quadro P2000                  61
# Quadro P1000                  61
# Quadro P600                   61
# Quadro P500                   61
# Quadro M5500M                 52
# Quadro M2200                  52
# Quadro M1200                  50
# Quadro M620                   52
# Quadro M520                   50
# Quadro K6000M                 30
# Quadro K5200M                 30
# Quadro K5100M                 30
# Quadro M5000M                 50
# Quadro K500M                  30
# Quadro K4200M                 30
# Quadro K4100M                 30
# Quadro M4000M                 50
# Quadro K3100M                 30
# Quadro M3000M                 50
# Quadro K2200M                 30
# Quadro K2100M                 30
# Quadro M2000M                 50
# Quadro K1100M                 30
# Quadro M1000M                 50
# Quadro K620M                  50
# Quadro K610M                  35
# Quadro M600M                  50
# Quadro K510M                  35
# Quadro M500M                  50
# -------- Desktop Products ---------
# NVIDIA NVS 810                50
# NVIDIA NVS 510                30
# NVIDIA NVS 315                21
# NVIDIA NVS 310                21
# -------- Mobile Products ----------
# NVS 5400M                     21
# NVS 5200M                     21
# NVS 4200M                     21
# ---- GeForce and TITAN Products ---
# GeForce RTX 3090              86
# GeForce RTX 3080              86
# GeForce RTX 3070              86
# NVIDIA TITAN RTX              75
# Geforce RTX 2080 Ti           75
# Geforce RTX 2080              75
# Geforce RTX 2070              75
# Geforce RTX 2060              75
# NVIDIA TITAN V                70
# NVIDIA TITAN Xp               61
# NVIDIA TITAN X                61
# GeForce GTX 1080 Ti           61
# GeForce GTX 1080              61
# GeForce GTX 1070 Ti           61
# GeForce GTX 1070              61
# GeForce GTX 1060              61
# GeForce GTX 1050              61
# GeForce GTX TITAN X           52
# GeForce GTX TITAN Z           35
# GeForce GTX TITAN Black       35
# GeForce GTX TITAN             35
# GeForce GTX 980 Ti            52
# GeForce GTX 980               52
# GeForce GTX 970               52
# GeForce GTX 960               52
# GeForce GTX 950               52
# GeForce GTX 780 Ti            35
# GeForce GTX 780               35
# GeForce GTX 770               30
# GeForce GTX 760               30
# GeForce GTX 750 Ti            50
# GeForce GTX 750               50
# GeForce GTX 690               30
# GeForce GTX 680               30
# GeForce GTX 670               30
# GeForce GTX 660 Ti            30
# GeForce GTX 660               30
# GeForce GTX 650 Ti BOOST      30
# GeForce GTX 650 Ti            30
# GeForce GTX 650               30
# GeForce GTX 560 Ti            21
# GeForce GTX 550 Ti            21
# GeForce GTX 460               21
# GeForce GTS 450               21
# GeForce GTS 450*              21
# GeForce GTX 590               20
# GeForce GTX 580               20
# GeForce GTX 570               20
# GeForce GTX 480               20
# GeForce GTX 470               20
# GeForce GTX 465               20
# GeForce GT 740                30
# GeForce GT 730                35
# GeForce GT 730 DDR3,128bit    21
# GeForce GT 720                35
# GeForce GT 705*               35
# GeForce GT 640 (GDDR5)        35
# GeForce GT 640 (GDDR3)        21
# GeForce GT 630                21
# GeForce GT 620                21
# GeForce GT 610                21
# GeForce GT 520                21
# GeForce GT 440                21
# GeForce GT 440*               21
# GeForce GT 430                21
# GeForce GT 430*               21
# ---- GeForce Notebook Products ----
# Geforce RTX 2080              75
# Geforce RTX 2070              75
# Geforce RTX 2060              75
# GeForce GTX 1080              61
# GeForce GTX 1070              61
# GeForce GTX 1060              61
# GeForce GTX 980               52
# GeForce GTX 980M              52
# GeForce GTX 970M              52
# GeForce GTX 965M              52
# GeForce GTX 960M              50
# GeForce GTX 950M              50
# GeForce 940M                  50
# GeForce 930M                  50
# GeForce 920M                  35
# GeForce 910M                  52
# GeForce GTX 880M              30
# GeForce GTX 870M              30
# GeForce GTX 860M              30/50
# GeForce GTX 850M              50
# GeForce 840M                  50
# GeForce 830M                  50
# GeForce 820M                  21
# GeForce 800M                  21
# GeForce GTX 780M              30
# GeForce GTX 770M              30
# GeForce GTX 765M              30
# GeForce GTX 760M              30
# GeForce GTX 680MX             30
# GeForce GTX 680M              30
# GeForce GTX 675MX             30
# GeForce GTX 675M              21
# GeForce GTX 670MX             30
# GeForce GTX 670M              21
# GeForce GTX 660M              30
# GeForce GT 755M               30
# GeForce GT 750M               30
# GeForce GT 650M               30
# GeForce GT 745M               30
# GeForce GT 645M               30
# GeForce GT 740M               30
# GeForce GT 730M               30
# GeForce GT 640M               30
# GeForce GT 640M LE            30
# GeForce GT 735M               30
# GeForce GT 635M               21
# GeForce GT 730M               30
# GeForce GT 630M               21
# GeForce GT 625M               21
# GeForce GT 720M               21
# GeForce GT 620M               21
# GeForce 710M                  21
# GeForce 705M                  21
# GeForce 610M                  21
# GeForce GTX 580M              21
# GeForce GTX 570M              21
# GeForce GTX 560M              21
# GeForce GT 555M               21
# GeForce GT 550M               21
# GeForce GT 540M               21
# GeForce GT 525M               21
# GeForce GT 520MX              21
# GeForce GT 520M               21
# GeForce GTX 485M              21
# GeForce GTX 470M              21
# GeForce GTX 460M              21
# GeForce GT 445M               21
# GeForce GT 435M               21
# GeForce GT 420M               21
# GeForce GT 415M               21
# GeForce GTX 480M              20
# GeForce 710M                  21
# GeForce 410M                  21
# --------- Jetson Products ---------
# Jetson AGX Xavier             72
# Jetson Nano                   53
# Jetson TX2                    62
# Jetson TX1                    53
# Tegra X1                      53
set(COMPUTE_CAPABILITY          75 CACHE STRING "CUDA Compute Capability") #< GPU compute capability
add_definitions(-DCOMPUTE_CAPABILITY=${COMPUTE_CAPABILITY})
message(STATUS "COMPUTE_CAPABILITY: ${COMPUTE_CAPABILITY}")
set(CMAKE_CUDA_ARCHITECTURES ${COMPUTE_CAPABILITY})

# Choose the memory management between the following:
# - "SC" (Standard Copy)
# - "UM" (Uniform Memory)
# - "ZC" (Zero Copy)
set(MEMORY_MODE "SC" CACHE STRING "Memory management mode: SC, UM, ZC or HY")
if ("${MEMORY_MODE}" STREQUAL "SC" OR
    "${MEMORY_MODE}" STREQUAL "UM" OR
    "${MEMORY_MODE}" STREQUAL "ZC" OR
    "${MEMORY_MODE}" STREQUAL "HY")
    message(STATUS "MEMORY_MODE: ${MEMORY_MODE}")
    add_definitions(-D${MEMORY_MODE})
else ()
    message(FATAL "MEMORY_MODE not recognized")
endif ()

message(STATUS "JETSON_TYPE: $ENV{JETSON_TYPE}")
if ("$ENV{JETSON_TYPE}" STREQUAL "AGX Xavier [16GB]" OR
    "$ENV{JETSON_TYPE}" STREQUAL "AGX Xavier [32GB]")
    message(STATUS "Device with HW_CACHE_COHERENCE")
    add_definitions(-DHW_CACHE_COHERENCE)
endif ()